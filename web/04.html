<html>
<head>
	<!-- ①ライブラリの読み込み -->
	<script src="https://unpkg.com/deck.gl@^8.9/dist.min.js"></script>
	<script src="https://unpkg.com/@loaders.gl/3d-tiles@^3.4/dist/dist.min.js"></script>
	<!-- ③地図領域のスタイル定義（100%全体） -->
	<style>
		#container { position: fixed; inset: 0; }
		#container > * {
			position: absolute; inset: 0; width: 100%; height: 100%; }
	</style>
	<script type="module">
		// ⑥光を当てる
		// （a）環境光
		const ambientLight = new deck.AmbientLight({
		  color: [255, 255, 255],
		  intensity: 3.0
		});
		// （b）太陽光
		const directionalLight = new deck._SunLight({
		  timestamp: Date.UTC(2024, 7, 1, 11),
		  color: [255, 255, 255],
		  intensity: 3.0,
		});	
		// （c）LightingEffectの作成
		const lightingEffect = new deck.LightingEffect({ambientLight, directionalLight});
		
		// ⑦地理院地図のレイヤー
		const tileLayer = new deck.TileLayer({
			  data: "https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
			  minZoom: 5,
			  maxZoom: 18,
			  tileSize: 256,
			  renderSubLayers: props => new deck.BitmapLayer(props, {
			    data: null,
			    image: props.data,
			    bounds: (({ west, south, east, north }) => [west, south, east, north])(props.tile.bbox),
			  }),
		});

		// ④3DTilesのレイヤーを準備
		const plateauLayer = new deck.Tile3DLayer({
		    data: '3dtiles/tileset.json',
		    loader: loaders.Tiles3DLoader
		});
		// ⑤deck.glで表示する
		const deckgl = new deck.Deck({
			canvas: 'deck-canvas',	// 表示先
			layers: [
				tileLayer,	// 地理院地図
				plateauLayer
			], // 表示レイヤー
			effects: [lightingEffect],	// LightingEffectの指定
			initialViewState: {	// 初期表示（視点）設定
				longitude: 139.691722, // 経度
				latitude: 35.689501,   // 緯度
				zoom: 15,        // ズーム
				minZoom: 2,     // 最小ズーム
				maxZoom: 18,     // 最大ズーム
				pitch: 45,      // 傾き
				bearing: 10,    // 回転
			},
			controller: true,
		});
	</script>
</head>
<body>
	<!-- ②地図の描画領域 -->
	<div id="container">
		<canvas id="deck-canvas"></canvas>
	</div>
</body>
</html>
